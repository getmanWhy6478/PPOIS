@startuml "Диаграмма классов — система печати документов"
!theme plain
skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam defaultFontSize 11

title Диаграмма классов (UML 2.x)\nПечать документов и изображений

' ========== Интерфейсы ==========
interface IPrintable {
  + {abstract} format: str
  + {abstract} pages: int
  + {abstract} validate(): bool
}

interface IConsumable {
  + {abstract} is_empty: bool
  + {abstract} consume(amount: float): void
}

interface IDriver {
  + {abstract} initialize(): bool
  + {abstract} send_print_command(document: IPrintable, settings: PrintSettings): bool
  + {abstract} run_maintenance(operation: str): bool
}

' ========== Исключения ==========
class PrinterException {
  - printer_state: Optional[str]
  + __init__(message: str, printer_state: Optional[str])
}

class OutOfPaperError
class LowInkError
class PaperJamError
class HardwareError
class InvalidDocumentError

PrinterException <|-- OutOfPaperError
PrinterException <|-- LowInkError
PrinterException <|-- PaperJamError
PrinterException <|-- HardwareError
PrinterException <|-- InvalidDocumentError

' ========== Настройки печати ==========
class PrintSettings {
  + quality: Literal['draft', 'normal', 'high']
  + color_mode: Literal['color', 'grayscale', 'black_and_white']
  + paper_type: Literal['plain', 'photo', 'glossy']
  + copies: int
  + duplex: bool
}

' ========== Документ ==========
class Document {
  - _filename: str
  - _format: str
  - _pages: int
  - _size_mb: float
  - SUPPORTED_FORMATS: set
  + filename: str
  + format: str
  + pages: int
  + size_mb: float
  + validate(): bool
  + __str__(): str
}

IPrintable <|.. Document : реализует

' ========== Расходные материалы ==========
class Paper {
  - _type: str
  - _quantity: int
  - VALID_TYPES: set
  - VALID_SIZES: dict
  + type: str
  + quantity: int
  + is_empty: bool
  + consume(amount: int): void
  + refill(quantity: int): void
}

class InkCartridge {
  - _color: str
  - _capacity: float
  - _level: float
  - VALID_COLORS: set
  + color: str
  + capacity: float
  + level: float
  + level_percent: float
  + is_empty: bool
  + consume(amount_ml: float): void
  + refill(): void
}

IConsumable <|.. Paper : реализует
IConsumable <|.. InkCartridge : реализует

' ========== Состояние принтера ==========
enum PrinterState {
  OFF
  IDLE
  PRINTING
  PAUSED
  OUT_OF_PAPER
  LOW_INK
  ERROR
  MAINTENANCE
}

' ========== Принтер ==========
class Printer {
  - _model: str
  - _driver: IDriver
  - _state: PrinterState
  - _paper: Paper
  - _cartridges: List«InkCartridge»
  - _maintenance_count: int
  - INK_CONSUMPTION_RATES: float
  + model: str
  + state: PrinterState
  + paper: Paper
  + cartridges: List«InkCartridge»
  + power_on(): bool
  + power_off(): bool
  + print_document(document: IPrintable, settings: PrintSettings): bool
  + load_paper(quantity: int): void
  + replace_ink(color: str): void
  + start_maintenance(operation: str): bool
  + get_status(): dict
  + to_dict(): dict
  + {static} from_dict(data: dict, driver: IDriver): Printer
}

Printer *-- "1" Paper : _paper
Printer *-- "1..*" InkCartridge : _cartridges
Printer --> "1" PrinterState : _state
Printer o-- "1" IDriver : _driver
Printer ..> IPrintable : использует при печати
Printer ..> PrintSettings : использует при печати
Printer ..> PrinterException : выбрасывает

' ========== Драйвер ==========
class PrinterDriver {
  - _initialized: bool
  - _supported_commands: dict
  + version: str
  + initialize(): bool
  + send_print_command(document: IPrintable, settings: PrintSettings): bool
  + run_maintenance(operation: str): bool
  - _cmd_init(): bool
  - _cmd_clean(): bool
  - _cmd_calibrate(): bool
}

IDriver <|.. PrinterDriver : реализует
PrinterDriver ..> IPrintable : использует
PrinterDriver ..> PrintSettings : использует

' ========== Хранилище состояния ==========
class PrinterStateStorage {
  - _storage_path: Path
  + save(printer: Printer): bool
  + load(driver: IDriver): Optional«Printer»
  + exists(): bool
  + delete(): bool
  + get_path(): str
}

PrinterStateStorage ..> Printer : сохраняет / загружает
PrinterStateStorage ..> IDriver : требуется для from_dict

@enduml
